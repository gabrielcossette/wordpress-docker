--- docker-entrypoint.sh	2018-02-24 23:51:29.419228306 -0500
+++ entrypoint_modif	2018-02-24 23:51:22.887269685 -0500
@@ -93,6 +93,10 @@
 		"${uniqueEnvs[@]/#/WORDPRESS_}"
 		WORDPRESS_TABLE_PREFIX
 		WORDPRESS_DEBUG
+		SITE
+		USER
+		PASS
+		EMAIL
 	)
 	haveConfig=
 	for e in "${envs[@]}"; do
@@ -234,6 +238,24 @@
 $mysql->close();
 EOPHP
 	fi
+    
+    if [ ! -d wp-content/plugins/nginx-helper ]; then
+
+	echo >&2 "WordPress not configured..."
+            
+    wp core install --url=$SITE --title="Site Web" --admin_user=$USER --admin_password=$PASS --admin_email=$EMAIL --allow-root
+
+	wp plugin install wp-clone-by-wp-academy --activate --allow-root
+
+	wp plugin install nginx-helper --activate --allow-root
+
+	wp plugin install redis-cache --activate --allow-root
+	
+	chown www-data:www-data -R ./
+	
+	set_config 'WP_REDIS_HOST' "redis"
+	
+	fi
 
 	# now that we're definitely done writing configuration, let's clear out the relevant envrionment variables (so that stray "phpinfo()" calls don't leak secrets from our code)
 	for e in "${envs[@]}"; do
@@ -241,4 +263,21 @@
 	done
 fi
 
+echo "Setup ssmtp"
+
+CONF=/etc/ssmtp/ssmtp.conf
+rm $CONF
+
+file_env 'SSMTP_AuthPass'
+
+for E in $(env)
+do
+  if [ "$(echo $E | sed -e '/^SSMTP_/!d' )" ]
+  then
+    echo $E | sed -e 's/^SSMTP_//' >> $CONF
+  fi
+done
+
+echo 'sendmail_path = "/usr/sbin/ssmtp -t"' > /usr/local/etc/php/conf.d/mail.ini
+
 exec "$@"
